<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>ToDoç®¡ç†ã‚¢ãƒ—ãƒª</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h1 class="title">ToDoç®¡ç†ã‚¢ãƒ—ãƒª</h1>

<!-- â–½â–½ ã‚¿ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â–½â–½ -->
<div class="tabs">
    <button class="tab-button active" onclick="openTab('tab-add')">æ–°è¦ToDoè¿½åŠ </button>
    <button class="tab-button" onclick="openTab('tab-list')">ToDoä¸€è¦§</button>
</div>
<!-- â–³â–³ ã‚¿ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â–³â–³ -->

<!-- â–½â–½ ã‚¿ãƒ–å†…å®¹1ï¼šæ–°è¦ToDoè¿½åŠ  â–½â–½ -->
<div id="tab-add" class="tab-content active">
  <div class="form-box">
    <h2>æ–°è¦ToDoè¿½åŠ </h2>
    <form method="POST">
      <label>ã‚¿ã‚¹ã‚¯
        <input type="text" name="task" placeholder="ä¾‹ï¼šè³‡æ–™ä½œæˆ">
      </label>

      <label>è©³ç´°èª¬æ˜
        <textarea name="description" placeholder="ä¾‹ï¼šExcelã®æ›´æ–°å¾Œã€pptã¸åæ˜ ã™ã‚‹"></textarea>
      </label>

      <label>æœŸæ—¥
        <input type="date" name="due">
      </label>

      <label>æå‡ºå…ˆï¼ˆä»»æ„ï¼‰
        <input type="text" name="submission_destination" placeholder="ä¾‹ï¼šç·å‹™ã€äººäº‹ã€ä¸Šå¸ã®åå‰ãªã©">
      </label>

      <button type="submit" class="btn-primary">ç™»éŒ²</button>
    </form>
  </div>
</div>
<!-- â–³â–³ ã‚¿ãƒ–å†…å®¹1 â–³â–³ -->


<!-- â–½â–½ ã‚¿ãƒ–å†…å®¹2ï¼šToDoä¸€è¦§ â–½â–½ -->
<div id="tab-list" class="tab-content">
  <div class="list-box">
    <h2>ToDoä¸€è¦§</h2>

    <table>
      <tr>
        <th>ID</th>
        <th>ã‚¿ã‚¹ã‚¯</th>
        <th>èª¬æ˜</th>
        <th>æœŸæ—¥</th>
        <th>æå‡ºå…ˆ</th>
        <th>ç·¨é›†</th>
        <th>å‰Šé™¤</th>
      </tr>

      {% for item in todos %}
      <tr>
        <td>{{ item.id }}</td>
        <td>{{ item.task }}</td>
        <td>{{ item.description or "" }}</td>
        <td>{{ item.due }}</td>
        <td>{{ item.submission_destination or "" }}</td>

        <td>
          <button class="btn-edit" onclick='openEditModal({
              "id": {{ item.id }},
              "task": {{ item.task|tojson }},
              "description": {{ item.description|tojson }},
              "due": {{ (item.due.strftime("%Y-%m-%d") if item.due else "")|tojson }},
              "submission_destination": {{ (item.submission_destination or "")|tojson }}
          })'>âœï¸</button>
        </td>

        <td>
          <form method="POST" action="/delete/{{ item.id }}" class="inline">
            <button type="submit" class="btn-delete" onclick="return confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">ğŸ—‘ï¸</button>
          </form>
        </td>
      </tr>
      {% endfor %}

    </table>
  </div>
</div>
<!-- â–³â–³ ã‚¿ãƒ–å†…å®¹2 â–³â–³ -->


<!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-overlay" id="editModal">
  <div class="modal">
    <span class="close-btn" onclick="closeEditModal()">âœ–</span>
    <h3>ToDoç·¨é›†</h3>

    <form method="POST" id="editForm">
      <label>ã‚¿ã‚¹ã‚¯
        <input type="text" name="task" id="edit_task">
      </label>

      <label>è©³ç´°èª¬æ˜
        <textarea name="description" id="edit_description"></textarea>
      </label>

      <label>æœŸæ—¥
        <input type="date" name="due" id="edit_due">
      </label>

      <label>æå‡ºå…ˆ
        <input type="text" name="submission_destination" id="edit_submission_destination">
      </label>

      <button type="submit" class="btn-primary">æ›´æ–°</button>
    </form>
  </div>
</div>


<script>
/* ã‚¿ãƒ–åˆ‡æ›¿ */
function openTab(tabId) {
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));

    event.target.classList.add('active');
    document.getElementById(tabId).classList.add('active');
}

/* ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« */
function openEditModal(data) {
    document.getElementById("edit_task").value = data.task || "";
    document.getElementById("edit_description").value = data.description || "";
    document.getElementById("edit_due").value = data.due || "";
    document.getElementById("edit_submission_destination").value = data.submission_destination || "";

    document.getElementById("editForm").action = "/edit/" + data.id;
    document.getElementById("editModal").style.display = "flex";
}

function closeEditModal() {
    document.getElementById("editModal").style.display = "none";
}
</script>

</body>
</html>
